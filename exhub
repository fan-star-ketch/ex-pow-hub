-- ⚡ Auto GamePass Menu (All-in-One)
-- Put this in ServerScriptService

local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- RemoteEvent to send data to client
local GamePassEvent = Instance.new("RemoteEvent")
GamePassEvent.Name = "GamePassListEvent"
GamePassEvent.Parent = ReplicatedStorage

-- Universe ID for this game
local universeId = game.GameId

-- Function: fetch passes
local function fetchGamepasses()
	local url = "https://games.roblox.com/v1/games/" .. universeId .. "/game-passes?limit=100"
	local success, result = pcall(function()
		return HttpService:GetAsync(url)
	end)
	if success then
		local data = HttpService:JSONDecode(result)
		if data and data.data then
			return data.data
		end
	end
	return {}
end

-- When player joins, send passes
Players.PlayerAdded:Connect(function(player)
	local passes = fetchGamepasses()
	GamePassEvent:FireClient(player, passes)

	-- Inject LocalScript into PlayerGui for UI
	local uiScript = Instance.new("LocalScript")
	uiScript.Name = "GamePassMenuUI"

	uiScript.Source = [[
		local Players = game:GetService("Players")
		local ReplicatedStorage = game:GetService("ReplicatedStorage")
		local MarketplaceService = game:GetService("MarketplaceService")
		local TweenService = game:GetService("TweenService")

		local player = Players.LocalPlayer
		local event = ReplicatedStorage:WaitForChild("GamePassListEvent")

		-- Colors
		local neonBlue = Color3.fromRGB(0, 255, 255)
		local neonPink = Color3.fromRGB(255, 0, 128)
		local darkBG = Color3.fromRGB(15, 15, 20)

		-- ScreenGui
		local screenGui = Instance.new("ScreenGui")
		screenGui.Name = "GamePassMenu"
		screenGui.ResetOnSpawn = false
		screenGui.Parent = player:WaitForChild("PlayerGui")

		-- Frame (auto-resize for mobile/pc)
		local frame = Instance.new("Frame")
		frame.Size = UDim2.new(0, 300, 0, 400)
		frame.Position = UDim2.new(0.5, 0, 0.5, 0)
		frame.AnchorPoint = Vector2.new(0.5, 0.5)
		frame.BackgroundColor3 = darkBG
		frame.Active = true
		frame.Draggable = true
		frame.Parent = screenGui

		Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)
		local stroke = Instance.new("UIStroke", frame)
		stroke.Thickness = 3
		stroke.Color = neonBlue

		-- Title
		local title = Instance.new("TextLabel", frame)
		title.Size = UDim2.new(1, -40, 0, 40)
		title.Position = UDim2.new(0, 10, 0, 0)
		title.BackgroundTransparency = 1
		title.Font = Enum.Font.GothamBold
		title.TextSize = 18
		title.TextColor3 = neonPink
		title.Text = "⚡ GamePasses ⚡"
		title.TextXAlignment = Enum.TextXAlignment.Center

		-- Minimize button
		local minimizeBtn = Instance.new("TextButton", frame)
		minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
		minimizeBtn.Position = UDim2.new(1, -35, 0, 5)
		minimizeBtn.BackgroundColor3 = darkBG
		minimizeBtn.Text = "-"
		minimizeBtn.Font = Enum.Font.GothamBold
		minimizeBtn.TextSize = 20
		minimizeBtn.TextColor3 = neonBlue
		Instance.new("UICorner", minimizeBtn).CornerRadius = UDim.new(0, 6)

		-- ScrollFrame
		local scrollFrame = Instance.new("ScrollingFrame", frame)
		scrollFrame.Size = UDim2.new(1, -20, 1, -60)
		scrollFrame.Position = UDim2.new(0, 10, 0, 50)
		scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
		scrollFrame.ScrollBarThickness = 6
		scrollFrame.BackgroundTransparency = 1

		local listLayout = Instance.new("UIListLayout", scrollFrame)
		listLayout.Padding = UDim.new(0, 8)

		-- Function: make pass button
		local function makePassButton(passInfo)
			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, -10, 0, 70)
			btn.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
			btn.Text = ""
			btn.Parent = scrollFrame

			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)
			local glow = Instance.new("UIStroke", btn)
			glow.Thickness = 2
			glow.Color = neonPink

			-- Icon
			local icon = Instance.new("ImageLabel", btn)
			icon.Size = UDim2.new(0, 60, 0, 60)
			icon.Position = UDim2.new(0, 5, 0.5, -30)
			icon.BackgroundTransparency = 1
			icon.Image = "rbxassetid://"..tostring(passInfo.iconImageAssetId or 0)

			-- Name
			local nameLabel = Instance.new("TextLabel", btn)
			nameLabel.Size = UDim2.new(1, -80, 0, 30)
			nameLabel.Position = UDim2.new(0, 75, 0, 10)
			nameLabel.BackgroundTransparency = 1
			nameLabel.Font = Enum.Font.GothamBold
			nameLabel.Text = passInfo.name or "Unknown"
			nameLabel.TextColor3 = neonBlue
			nameLabel.TextXAlignment = Enum.TextXAlignment.Left
			nameLabel.TextSize = 16

			-- Price
			local priceLabel = Instance.new("TextLabel", btn)
			priceLabel.Size = UDim2.new(1, -80, 0, 20)
			priceLabel.Position = UDim2.new(0, 75, 0, 40)
			priceLabel.BackgroundTransparency = 1
			priceLabel.Font = Enum.Font.Gotham
			priceLabel.Text = tostring(passInfo.price or "?").." R$"
			priceLabel.TextColor3 = neonPink
			priceLabel.TextXAlignment = Enum.TextXAlignment.Left
			priceLabel.TextSize = 14

			-- Hover + click to buy
			btn.MouseEnter:Connect(function()
				TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = neonPink}):Play()
			end)
			btn.MouseLeave:Connect(function()
				TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 25, 35)}):Play()
			end)
			btn.MouseButton1Click:Connect(function()
				MarketplaceService:PromptGamePassPurchase(player, passInfo.id)
			end)
		end

		-- Minimize logic
		local minimized = false
		minimizeBtn.MouseButton1Click:Connect(function()
			minimized = not minimized
			if minimized then
				scrollFrame.Visible = false
				frame.Size = UDim2.new(0, 300, 0, 50)
				minimizeBtn.Text = "+"
			else
				scrollFrame.Visible = true
				frame.Size = UDim2.new(0, 300, 0, 400)
				minimizeBtn.Text = "-"
			end
		end)

		-- Receive passes
		event.OnClientEvent:Connect(function(passes)
			for _, pass in ipairs(passes) do
				makePassButton(pass)
			end
			scrollFrame.CanvasSize = UDim2.new(0, 0, 0, #passes * 80)
		end)
	]]

	uiScript.Parent = player:WaitForChild("PlayerGui")
end)
